[TOC]

# 1 引言

## 1.1 编写目的

《详细设计书》是项目设计的第二个阶段，这个阶段的主要任务是在《概要设计书》基础上，对概要设计中产生的功能模块进行过程描述，设计功能模块的内部细节，包括类的详细逻辑和接口及类之间的调用关系，为编写源代码提供必要的说明。 

本文档的目的旨在推动软件工程的规范化，使设计人员遵循统一的详细设计书写规范，节省制 作文档的时间，降低系统实现的风险，做到系统设计资料的规范性与全面性，以利于系统的实现、测试、维护、版本升级等。 

概要设计解决了软件系统总体结构设计的问题，包括整个软件系统的结构、模块划分、模块功 能和模块间的联系等。详细设计则要解决如何实现各个模块的内部功能，即模块设计。具体的说，模块设计就是要详细描述各模块中包含的类的处理逻辑及其提供接口的参数格式、请求方式。但这并不等同于系统实现阶段用具体的语言编码，它只是对实现细节作精确的描述，这样编码阶段就可以将详细设计中对功能实现的描述，直接翻译、转化为用某种程序设计语言书写的程序。详细设计的详细程度应达到可以编写程序的水平。

## 1.2 背景与依据

本项目是一款网上演出购票平台，用户可以登录后查看上线的各大演出，并下单购买自己喜欢的演出门票，也可以管理自己已经购买的票务详情。详细设计的依据来自先前的3个文档。

## 1.3 参考资料

 [1] IEEE. IEEE Std 830-1998 IEEE Recommended Practice for Software Requirements Specifications. IEEE Computer Society, 1998. 

 [2] Software H. Example Use Case Specification[R/OL]. [2013-11-15]. http://www.hippo-software.co.uk/downloads/Example%20Use%20Case%20Specification.pdf

 [3]博影演出购票平台-需求规约.doc

 [4]博影演出购票平台-需求分析规约.doc

 [5]博影演出购票平台-概略设计规约.doc

# 2 系统软件结构

![img](https://i.loli.net/2021/06/13/PNIvpc4iyQhqz9D.jpg)

 

# 3 类设计

## 3.1 用户模块

用户类图：

![img](https://i.loli.net/2021/06/14/Xy8jUTRq4MSEz9r.jpg)



属性：用户ID，账号，手机号，密码，真实姓名，身份证号，邮箱，年龄，性别，头像，创建时间，状态。

方法：账号密码登陆、手机号密码登陆、手机号验证码登陆、注册、生成验证码、跟新个人信息。

说明：用户的基本信息，以及一系列基本活动。被已登陆用户、未登陆用户与管理员用户继承，是最基础的角色类。用户的所有属性都是持久的，它存储了注册用户的基本信息。

### 3.1.1 模块描述

用户模块包括了登陆、注册，以及用户个人信息的管理，包括头像、邮箱、年龄、身份证号、性别、真实姓名。管理个人信息的功能需要用户登陆后才能使用。

### 3.1.2 功能

注册：用户可以选择注册一个个人账号。

登陆：登陆后可以购票、管理订单等。

管理个人信息：用户可以修改其个人信息包括修改头像、邮箱、年龄、身份证号、性别、真实姓名。

#### 3.1.2.1 注册的详细设计

输入项：注册用户用户名、注册用户密码、注册用户手机号、注册用户验证码、注册用户头像（可选）。

输出项：注册成功，请登录的提示信息。

##### 逻辑流程

![img](https://i.loli.net/2021/06/14/DG9OwVHYto1ShpQ.jpg)

 

##### 接口

基本信息：

| 功能描述     | 用户注册       |
| ------------ | -------------- |
| URL          | /user/register |
| 支持格式     | JSON           |
| HTTP请求方式 | POST           |

 

请求参数：

| 参数      | 必选  | 类型   | 说明               |
| --------- | ----- | ------ | ------------------ |
| username  | true  | string | 用户注册的账号名称 |
| password  | true  | string | 用户的密码         |
| telephone | true  | string | 用户的电话号码     |
| authCode  | true  | string | 验证码             |
| icon      | False | string | 用户可以上传头像   |

 

#### 3.1.2.2 登陆的详细设计

输入项：登陆用户账号、登陆用户密码或者登陆用户手机号、登陆用户密码或者登陆用户手机号、登陆用户验证码

输出项：主页

逻辑流程：

![img](https://i.loli.net/2021/06/14/zKB3SAWZIrdasbp.jpg)

 

##### 账号密码登陆接口

基本信息：

| 功能描述     | 用户用账号密码登陆 |
| ------------ | ------------------ |
| URL          | /usernameLogin     |
| 支持格式     | JSON               |
| HTTP请求方式 | POST               |

 

请求参数：

| 参数     | 必选 | 类型   | 说明               |
| -------- | ---- | ------ | ------------------ |
| username | true | string | 用户输入的账号名称 |
| password | true |        | 用户输入的密码     |

 

返回字段：

| 返回字段 | 字段类型 | 说明                                                         |
| -------- | -------- | ------------------------------------------------------------ |
| Token    | string   | 将用户输入的密码加密后与数据库查到的user密码对比（密码错误则报错给前端）,在服务器内存中存储了该用户信息，返回token给前端. |

 

##### 手机号密码登陆接口

基本信息：

| 功能描述     | 用户用手机号密码登陆 |
| ------------ | -------------------- |
| URL          | /telephoneLogin      |
| 支持格式     | JSON                 |
| HTTP请求方式 | POST                 |

 

请求参数：

| 参数      | 必选 | 类型   | 说明             |
| --------- | ---- | ------ | ---------------- |
| telephone | true | string | 用户输入的手机号 |
| password  | true |        | 用户输入的密码   |

 

返回字段：

| 返回字段 | 字段类型 | 说明                                                         |
| -------- | -------- | ------------------------------------------------------------ |
| Token    | string   | 将用户输入的密码加密后与数据库查到的user密码对比（密码错误则报错给前端）,在服务器内存中存储了该用户信息，返回token给前端. |

 

##### 手机号验证码登陆接口

基本信息：

| 功能描述     | 用户用手机号验证码登陆 |
| ------------ | ---------------------- |
| URL          | /authCodeLogin         |
| 支持格式     | JSON                   |
| HTTP请求方式 | POST                   |

 

请求参数：

| 参数      | 必选 | 类型   | 说明             |
| --------- | ---- | ------ | ---------------- |
| telephone | true | string | 用户输入的手机号 |
| authCode  | true |        | 用户输入的验证码 |

 

返回字段：

| 返回字段 | 字段类型 | 说明                                             |
| -------- | -------- | ------------------------------------------------ |
| Token    | string   | 在服务器内存中存储了该用户信息，返回token给前端. |

 

##### 限制条件与出错处理

1）登录用户的账号和密码或者手机号和密码或者手机号和验证码应当匹配

2）如果用户输入的账号和密码或者手机号和密码或者手机号和验证码不匹配，显示登录失败的提示信息

 

#### 3.1.2.3 管理个人信息的详细设计

输入项：用户id、用户头像、用户年龄、用户邮箱、用户性别、用户身份证号、用户真实姓名。

输出项：显示修改成功的提示信息，并刷新个人信息页面。

 

##### 逻辑流程

![img](https://i.loli.net/2021/06/13/EBsZuhOdWK86wb5.jpg)

##### 接口

 

基本信息：

| 功能描述     | 更新个人信息 |
| ------------ | ------------ |
| URL          | /user/update |
| 支持格式     | JSON         |
| HTTP请求方式 | POST         |

请求参数：

| 参数           | 必选 | 类型   | 说明           |
| -------------- | ---- | ------ | -------------- |
| age            | true | string | 用户年龄       |
| Email          | True | String | 用户邮箱       |
| Gender         | true | string | 用户性别       |
| identityNumber | true | string | 用户的身份证号 |
| Realname       | true | string | 用户真实姓名   |
| icon           | True | string | 用户头像       |

返回字段：

| 返回字段 | 字段类型 | 说明           |
| -------- | -------- | -------------- |
| Status   | string   | 返回结果状态。 |

 

##### 限制条件与出错处理

1）用户上传头像只能上传jpg/jpeg/png文件，且不超过5MB。

2）若用户上传的头像文件不符合要求则提示上传头像失败。

3）限制用户需登陆才会在导航栏出现“我的信息”

## 3.2 演出模块

演出目录类：

![img](https://i.loli.net/2021/06/14/VvxZtsGaSgh3Efp.jpg)

 

属性：演出类型ID，目录名称，权重，图标，文字描述，状态。

方法：添加演出目录、删除演出目录

说明：便于对各种各样的演出进行统一管理。

 

演出类：

![img](https://i.loli.net/2021/06/13/uwXB4qamhPTN8RM.jpg)



属性：演出ID，演出名，所属类型，海报，权重，城市，具体地址，开始日期，结束日期，详情。

方法：添加演出、删除演出

说明：演出的基本信息。演出类中所有属性都是持久化的，它负责存储演出的基本信息。

 

座次类：

![img](https://i.loli.net/2021/06/14/rFqBMRA1LmocUNv.jpg)



属性：演出座次ID，所属演出ID，座次名称，库存，容量，定价。

方法：管理员创建座次、获取座次列表。

说明：演出的座次信息。

 

票类：

![img](https://i.loli.net/2021/06/13/QzjxWRkq4NoeFtO.jpg)

 

属性：票ID，所属订单ID，所属座次ID，二维码图片。

方法：用户/管理员获取票的列表、用户添加票

说明：演出的票信息。

 

### 3.2.1 模块描述

该模块包括了用户浏览网站时的演出相关内容，具体包括搜索演出、查看演出详情、购票。该模块的所有功能必须要用户登陆才可使用。点击演出的标题或者海报等可以查看演出详情，进入演出详情页面可以购票。

### 3.2.2 功能

搜索演出：用户可以通过关键词、城市、时间、类别中的一个或者多个条件搜索对应的演出进行浏览。

 

查看演出详情：用户点击某个演出的标题或海报等后便可查看该演出的详细内容。

购票：用户可以在演出详情页面选择座次进行购票。

#### 3.2.2.1 搜索演出的详细设计

输入项：搜索演出类别、搜索演出关键词、搜索演出城市、搜索演出时间

输出项：演出搜索结果的页面

##### 逻辑流程

![img](https://i.loli.net/2021/06/13/PvzFY35mibdITQJ.jpg)

 

##### 接口

搜索筛选演出

基本信息：

| 功能描述     | 演出的综合搜索筛选 |
| ------------ | ------------------ |
| URL          | /search            |
| 支持格式     | JSON               |
| HTTP请求方式 | POST               |

请求参数：

| 参数       | 必选  | 类型   | 说明                     |
| ---------- | ----- | ------ | ------------------------ |
| keyword    | False | string | 用户想要搜索的演出关键词 |
| city       | False | String | 用户想要搜索的演出城市   |
| categoryId | False | Int    | 用户想要搜索的演出类别   |
| pageNum    | False | Int    | 分页数                   |
| pageSize   | False | Int    | 每页条数                 |

返回字段：

| 返回字段                             | 字段类型 | 说明                               |
| ------------------------------------ | -------- | ---------------------------------- |
| CommonResult<CommonPage<BoyingShow>> | string   | 返回符合要求的演出并按权重降序排列 |

##### 限制条件与出错处理

​		1）限制所有搜索条件都为模式匹配的子字符串。

​		2）当搜索结果为空时，搜索结果页面显示空白。

​		3）限制用户在搜索前应登录账号。

​		4）如果用户未登录则直接跳转至登陆页面。

 

#### 3.2.2.2 查看演出详情的详细设计

输入项：用户所选择演出id

输出项：演出详情页面

##### 逻辑流程

![img](https://i.loli.net/2021/06/14/xlw1EsQz5i7KIog.jpg)

 

##### 接口

基本信息：

| 功能描述     | 获取某个演出的详情 |
| ------------ | ------------------ |
| URL          | /show/detail/{id}  |
| 支持格式     | JSON               |
| HTTP请求方式 | GET                |

 

请求参数：

| 参数 | 必选 | 类型   | 说明                 |
| ---- | ---- | ------ | -------------------- |
| Id   | True | string | 想要查看详情的演出ID |

 

返回字段：

| 返回字段                 | 字段类型 | 说明                                  |
| ------------------------ | -------- | ------------------------------------- |
| CommonResult<BoyingShow> | string   | 通过show_id获取并返回该演出的详细信息 |

 

##### 限制条件与出错处理

1）限制用户在查看演出详情前应登录账号。

​		2）如果用户未登录则直接跳转至登陆页面。

 

 

#### 3.2.2.3 购票的详细设计

输入项：用户所选择演出id，用户所选择座次

输出项：生成相应订单

##### 逻辑流程

![img](https://i.loli.net/2021/06/14/7XkBgWY3a9D4iwt.jpg)

 

##### 接口

用户下单接口：

基本信息：

| 功能描述     | 用户购买门票 |
| ------------ | ------------ |
| URL          | /order/add   |
| 支持格式     | JSON         |
| HTTP请求方式 | POST         |

 

请求参数：

| 参数        | 必选 | 类型   | 说明   |
| ----------- | ---- | ------ | ------ |
| showId      | True | string | 演出ID |
| showSeatIds | True | string | 座次ID |

 

返回字段：

| 返回字段 | 字段类型 | 说明           |
| -------- | -------- | -------------- |
| Message  | string   | 返回结果状态。 |

 

##### 限制条件与出错处理

1）限制用户不能重复购买同一场次的票。

2）如果用户重复购买，则显示重复购买，购票失败的提示信息

## 3.3 订单模块

订单类：

![img](https://i.loli.net/2021/06/14/GZ4VvP6wUB3cWDS.jpg)

 

属性：订单ID，所属用户ID，所属演出ID，订单状态，提交时间，用户删除状态，管理员删除状态，总金额，票数量。

方法：添加订单、删除订单、取消订单、完成订单。

说明：用户的订单信息。

 

### 3.3.1 模块描述

订单模块包括了订单的查看与管理，包括查看所有订单、查看待观看订单、查看已完成订单、查看已退订单、删除已退订单、取消待观看订单。与订单相关的所有的功能需要用户登陆后才能使用。

### 3.3.2 功能

查看订单：用户可以查看所有订单、查看待观看订单、查看已完成订单、查看已退订单。

查看订单详情：用户在订单列表中选择订单并点击查看订单按钮可查看订单详情。

删除订单：用户可以删除已退订单。

取消订单：用户可以取消待观看订单。

 

#### 3.3.2.1 查看订单的详细设计

输入项：用户选择查看所有订单、查看待观看订单、查看已完成订单、查看已退订单。

输出项：显示用户选择的相应订单列表。

##### 逻辑流程

![img](https://i.loli.net/2021/06/14/BgcYGO9xFdR81hK.jpg)



##### 接口

基本信息：

| 功能描述     | 查看所有订单 |
| ------------ | ------------ |
| URL          | /order/list  |
| 支持格式     | JSON         |
| HTTP请求方式 | GET          |

 

请求参数：

 

| 参数 | 必选 | 类型   | 说明   |
| ---- | ---- | ------ | ------ |
| Id   | True | string | 用户ID |

 

返回字段：

| 返回字段 | 字段类型 | 说明     |
| -------- | -------- | -------- |
| list     | string   | 订单列表 |
| pageNum  | Int      | 分页数   |
| pageSize | int      | 每页条数 |

 

##### 限制条件与出错处理

1） 限制用户需登陆才会在导航栏出现“我的订单”

2） 当用户无订单时，订单列表页面显示空白。

 

 

#### 3.3.2.2 查看订单详情的详细设计

输入项：订单ID

输出项：订单详情页面

##### 逻辑流程

![img](https://i.loli.net/2021/06/13/j7SC4q8xUQeN3pA.jpg)

 

##### 接口

获取订单详情

基本信息：

| 功能描述     | 查看订单详情        |
| ------------ | ------------------- |
| URL          | /order/details/{id} |
| 支持格式     | JSON                |
| HTTP请求方式 | GET                 |

 

请求参数：

 

| 参数 | 必选 | 类型   | 说明   |
| ---- | ---- | ------ | ------ |
| Id   | True | string | 订单ID |

 

返回字段：

| 返回字段 | 字段类型 | 说明               |
| -------- | -------- | ------------------ |
| Data     | string   | 返回订单和票的信息 |

 

 

#### 3.3.2.3 删除订单的详细设计

输入项：订单ID

输出项：不显示被删除的订单，刷新订单列表

##### 逻辑流程

![img](https://i.loli.net/2021/06/13/m6WVoHdUI4w8AJp.jpg)

 

##### 接口

删除订单

基本信息：

| 功能描述     | 删除订单           |
| ------------ | ------------------ |
| URL          | /order/delete/{id} |
| 支持格式     | JSON               |
| HTTP请求方式 | POST               |

 

请求参数：

 

| 参数 | 必选 | 类型   | 说明   |
| ---- | ---- | ------ | ------ |
| Id   | True | string | 订单ID |

 

返回字段：

| 返回字段 | 字段类型 | 说明     |
| -------- | -------- | -------- |
| Message  | string   | 返回结果 |

 

 

#### 3.3.2.4 取消订单的详细设计

输入项：订单ID

输出项：被取消的待观看订单变为已退订单。

##### 逻辑流程

![img](https://i.loli.net/2021/06/13/oxXhD1g7wI6zHYW.jpg)

 

##### 接口

取消订单

基本信息：

| 功能描述     | 取消订单           |
| ------------ | ------------------ |
| URL          | /order/cancel/{id} |
| 支持格式     | JSON               |
| HTTP请求方式 | POST               |

 

请求参数：

 

| 参数 | 必选 | 类型   | 说明   |
| ---- | ---- | ------ | ------ |
| Id   | True | string | 订单ID |

 

返回字段：

| 返回字段 | 字段类型 | 说明     |
| -------- | -------- | -------- |
| Message  | string   | 返回结果 |

 

## 3.4 管理员管理模块

管理员分析类图

![img](https://i.loli.net/2021/06/14/FL7hKBMT4qGZstW.jpg)

 

属性：ID、管理员名称username、密码password、图标icon、上次登陆时间last_time

方法：管理员登陆、查询并获取管理员信息（其他继承自user类）

说明：管理员的基础信息及管理方法。对各项信息的管理接口集成在了各模块中（限制因素为用户身份），故管理员类下有登陆方法（登陆后台管理时使用）及获取管理员信息（进行管理）。

 

### 3.4.1 模块描述

管理员模块包含管理员信息属性、管理员的登陆方法及管理员获取其他管理员信息的方法。

 

### 3.4.2 功能

管理员登陆：根据账号密码登陆

获取管理员信息：根据用户名参数获取管理员信息（进行管理员管理）

#### 3.4.2.1 管理员登陆的详细设计

输入项：登陆信息（由前端页面输入账号密码后生成）

输出项：登陆认证结果

##### 逻辑流程

![img](https://i.loli.net/2021/06/14/JtNBfUuKv6X9Pke.jpg)

 

##### 接口

管理员登陆

基本信息：

| 功能描述     | 取消订单     |
| ------------ | ------------ |
| URL          | /login/login |
| 支持格式     | JSON         |
| HTTP请求方式 | POST         |

 

请求参数：

 

| 参数     | 必选 | 类型   | 说明         |
| -------- | ---- | ------ | ------------ |
| Username | True | string | 管理员账号名 |
| Password | True | string | 管理员密码   |

 

返回字段：

| 返回字段 | 字段类型 | 说明     |
| -------- | -------- | -------- |
| Message  | string   | 返回结果 |

 