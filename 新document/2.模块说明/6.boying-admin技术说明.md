# 背景知识

## 权限系统

权限系统就是：明确操作人员可在平台内能做什么。即什么样的人，可以做什么样的事，这并不难理解，我们的用户是所有可以登录该平台的人员。

“用户管理”、“角色管理”、“权限管理”

RBAC即：权限与角色相关联，用户通过成为适当角色的成员而得到这些角色的权限。

用户与角色一一对应，一个用户对应一个角色；同一个角色可对应多个后台操作页面

RBAC结构可通过“角色”搭建用户与权限之间的关系，可在创建角色时绑定相应权限，再匹配到用户，可提高整体的效率以及稳定性。

## 认证

用户认证通过后，将用户信息保存在会话中，如token等。基于JWT令牌，会话通过token保存。认证是保护用户身份的合法性。

## 授权

更细粒度的对隐私数据进行划分。授权是用户认证通过根据用户的权限来控制用户访问资源的过程。



## RBAC

“用户-角色-权限”管理是 **“访问控制”** 的一种实现方式，更为专业的叫法为 **RBAC**（Role-Based Access Control），即基于角色的权限访问控制。

权限的三种粒度：**菜单权限、操作/功能权限、数据权限**。

## 用户管理

- **用户信息：** 显示用户的基本信息（昵称、联系方式、角色、部门等）
- **组织架构：** 显示、配置（增删改）组织架构，一般为树结构
- **用户操作：** 为用户分配角色（多对多）、组织架构（多对多），删除用户
- **用户黑白名单：** 对特殊用户进行特别控制

## 角色管理

- **角色信息：** 显示角色的基本信息（名称、权限等）
- **角色操作：** 根据需要增删角色、为角色分配权限（多对多，按不同粒度分配，并实现权限的互斥性检验）

## 权限管理

权限一般有如下三种粒度：

- **菜单权限：** 访问某一菜单（页面、路由）的权限
- **操作/功能权限：** 进行某一操作或使用某一功能的权限（如删除用户的权限）
- **数据权限：** 访问某种数据（表、字段）的权限，或对可操作数据量的控制

## 技术要点

- 用户、角色、权限、组织架构表结构设计
- 用户身份验证、授权、会话管理，用户信息的加密存储
- 不同粒度权限的具体实现

## 权限管理

- 菜单管理：可以实现对后台管理系统左侧菜单的管理，支持更换图标、更换名称、控制菜单显示和排序；
- 资源管理：实现了基于访问路径的后台动态权限控制，控制的权限可以精确到接口级别；
- 角色管理：可以自定义角色，并为角色分配菜单和资源；
- 后台用户管理：可以对后台用户进行管理并分配角色，支持分配多个角色。





# config

## AdminUserDetails

SpringSecurity需要的用户详情

```java
public class AdminUserDetails implements UserDetails
{
    private final AdminUser adminUser;
    private final List<AdminResource> resourceList;

    public AdminUserDetails(AdminUser AdminUser, List<AdminResource> resourceList)
    {
        this.adminUser = AdminUser;
        this.resourceList = resourceList;
    }

    @Override
    public Collection<? extends GrantedAuthority> getAuthorities()
    {
        //返回当前用户拥有的资源权限
        return resourceList.stream()
                .map(AdminResource -> new SimpleGrantedAuthority(AdminResource.getId() + ":" + AdminResource.getName()))
                .collect(Collectors.toList());
    }
    
    //根据status标识该账号是否可用
     @Override
    public boolean isEnabled()
    {
        return adminUser.getStatus();
    }
}
```

## BoyingSecurityConfig

### userDetailsService()

根据用户名获取登录用户信息

### dynamicSecurityService()

要实现动态路径控制则必须实现该方法,注入`Bean`,目的是加载所有的资源,这通过一个Map实现,存储资源路径url,资源路径值(自定义为了 id:name )



## GlobalCorsConfig

全局跨域相关配置

## MyBatisConfig

MyBatis相关配置，控制dao或者mapper文件扫描位置

## SwaggerConfig

对boying-common的swagger相关组件进行自定义配置。Swagger API文档相关配置，主要是api扫描位置以及标题等

