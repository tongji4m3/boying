

软件系统的名称，所有团队的全名和预科编号  成员、联系电话、电子邮件地址和其他细节

（加首页）

[toc]

# 1.项目背景（代做）

## 项目简介（技术向）

**boying**是一个娱乐票务平台，包括**前台演出门票购买系统**及**后台管理系统**。

前台系统包括:用户模块,目录模块,演出模块,订单模块

后台系统包括:报表管理,用户管理,演出管理,场次管理,订单管理

## 项目地址

- 文档地址:https://tongji4m3.github.io/boying
- 演出门票购买系统前端项目地址:[boying-web](https://github.com/tongji4m3/boying-web)
- 后台管理前端项目地址:[boying-admin-web](https://github.com/tongji4m3/boying-admin-web)
- 项目演示地址(演出门票购买界面):http://47.103.203.188:8080/boying-user/index.html
- 项目演示地址(后台管理页面):http://47.103.203.188:8080/boying-admin/index.html
- 后端演出门票购买系统接口地址:http://47.103.203.188:8000/swagger-ui.html
- 后端后台管理系统接口地址:http://47.103.203.188:7000/swagger-ui.html

## 简介

介绍项目总体思路，突出创意

新一代互联网主力人群由于缺乏群体记忆，加之互联网快速分化，个性化群体快速崛起，文化需求多元化加重。现场娱乐市场作为一个多元化市场，分类众多，且各具特色。但由于行业观演环境还有待改善和培育，因此整个市场尚待焕发生机。在市场及需求的驱动下，现场娱乐在线票务平台发展迅速，比如大麦网、摩天轮票务、体育易等等。正是基于这些软件作为参考，制作一款具有特色的娱乐票务网站——博影。，该项目为有现场观看音乐剧、话剧等演出需求的用户提供演出信息与购票服务，实现该软件的计算中心或计算机网络为互联网，该软件系统同其他系统或其他机构的基本的相互来往关系

对于有线下观看话剧、音乐剧、演唱会等演出的需求的用户，我们提供了博影这个平台。用户不仅能够获取最新的演出信息并购票，还能对演出进行评论，结交志同道合的好友。

## 另一个背景..

随着经济的快速发展，越来越多的人们开始关注精神文化生活，在业余时间会去选择欣赏演唱会、电影、话剧等各种形式的演出，同时人们对服务的快捷、便利性要求也越来越高，从而对售票的建设与管理提出了更高的要求。传统的线下售票方式存在很多的缺陷值得改善，比如实时差、交易时间过长、运营成本高、信息不共享等，已无法满足用户的需求，在这种背景下，我们希望搭建一个网络平台，让用户在到达演出地之前就能了解演出的相关内容，并实现在线订票，以免浪费时间，从而实现票务的信息化。所以Boying——博影娱乐票务平台就应运而生了。

Boying是一个综合类现场娱乐票务营销平台，业务覆盖演唱会、 话剧、音乐剧、体育赛事等领域，目标是让用户安全、快速、便捷地购买各种演出票务，提高用户的体验感。系统管理员在后台管理各种类型、不同场次的演出票务信息，并且对系统的用户、订单等各种信息进行管理。用户可以在网站上浏览演出列表，查看每一个演出的时间、地点、场次等详细信息，然后根据自己的喜好选择相应的场次进行购票。此外，Boying还提供了评价功能，用户可以对自己观看的演出进行评价。在个人信息界面，用户可以对自己的账号基本信息进行修改，查看自己的历史订单与评价。

Boying是一个开放的平台，用户无需登录账号，便可以浏览网页上的票务信息，但是，用户必须注册账号并登陆后，才可以使用购票以及后续的功能。为了保护用户的隐私，其他用户在访问单个用户的个人主页时无法查看其基本信息和订单、评价信息，用户也可以根据自己的需要在个人主页中修改自己信息。

与传统的购票模式相比，Boying利用利用互联网的便利性，用户可以实时掌握最新的演出信息，并根据个人兴趣来决定是否买票，由此可避免传统售票模式给用户带来的不良感受，如浪费时间以及购不到票等；此外，Boying是传统售票模式的全流程模拟，用户可在任意有网络的地方完成整个购票流程，不再受到地域限制；对于票务的出品方，Boying实现的票务信息化可以降低实际的购票交易时间，提高公司工作人员的工作效率，降低公司的运营成本，Boying既可以实时共享票务信息给用户，也以可满足用户在线预订的需求，由此可缓解高峰期票务点的购票压力，既让用户享受了优质的购票体验，也为售票公司提供了便利。

为了方便网站的运营人员管理系统，我们为管理员设置了特殊的后台界面，管理员可以在后台管理系统的演出、用户、订单等信息。

Boying——博影娱乐票务平台顺应互联网时代的发展潮流，同时为人们提供了一个的优质的购票平台。

# 2.实施的系统功能完整列表（代做）

明确说明所有已实现的功能

用例图，用例规约，活动图，时序图七七八八的，能加就加

活动图和（或）泳道图

状态图和（或）时序图

参考：**boying\document\6.内存数据库文档\Boying——博影系统需求分析文档.docx**



# 3.用户手册（代做）

（包括带有用户界面快照和描述的示例场景）

并从最终用户的角度演示系统

# 4.系统部署和配置的说明

本项目部署与阿里云轻量级应用服务器上，使用的系统镜像为CentOS 7.3。

该服务器公网IP地址为：47.103.203.188，配置为1核2G

## 4.1 项目地址

- 项目演示地址(前台用户界面):http://47.103.203.188:8080/boying-user/index.html
- 项目演示地址(后台管理页面):http://47.103.203.188:8080/boying-admin/index.html
- 后端Swagger接口地址（用户模块）:http://47.103.203.188:8000/swagger-ui.html
- 后端Swagger接口地址（管理员模块）:http://47.103.203.188:7000/swagger-ui.html



## 4.2 本地搭建步骤(Windows)

### 4.2.1 前端搭建步骤

```
//默认连接的是远程后端与远程数据库
进入 boying-web 或者 boying-admin-web 项目根目录
在命令行下输入如下指令:
npm install
npm run serve
访问:http://localhost:8080/
//如果同时打开boying-web与boying-admin-web会出现端口冲突,请自行配置
//如果要连接自己的后端,请在src\assets\api.js文件中,更改 API_URL: "http://自己的ip地址:自己的端口号"
```

### 4.2.2 后端搭建步骤

```
//默认连接的是远程Mysql和Redis
用Idea打开boying项目
在右侧的Maven中选择Lifecycle中的package,安装相关依赖.随后选择Reload All Maven Projects
若要启动boying-user后端,则运行boying-user子系统的src\main\java\com\tongji\boying\BoyingUserApplication.java中的main方法
启动成功后,则可以访问swagger接口:http://localhost:8000/swagger-ui.html
若要启动boying-admin后端,则运行boying-admin子系统的src\main\java\com\tongji\boying\BoyingAdminApplication.java
启动成功后,则可以访问swagger接口:http://localhost:7000/swagger-ui.html
```

### 4.2.3 数据库搭建步骤

数据库的搭建依赖与docker，请先根据网上教程安装好docker

**Mysql搭建**

```
docker pull mysql:5.7
docker run -d --name mysql -p 3306:3306 -e MYSQL_ROOT_PASSWORD=root mysql:5.7
```

**Redis搭建**

```
docker pull redis
docker run -d --name redis -p 6379:6379 redis --requirepass "redis"
```



## 4.3 远程服务器搭建步骤(Linux)

### 4.3.1 前端搭建步骤

需要在boying-user、boying-admin的根路径下使用npm run build命令

随后把根路径下的对应dist文件上传到服务器/root/webapps路径下

```
docker pull tomcat
docker run --name tomcat -p 8080:8080 -v /root/webapps:/usr/local/tomcat/webapps -d tomcat 
当把dist文件放入/root/webapp并修改名为boying-user、boying-admin即可访问
访问路径：
http://自己IP地址:8080/boying-user
http://自己IP地址:8080/boying-admin
```

### 4.3.2 后端搭建步骤

```
要更换数据库,则在boying项目中的boying-user，boying-admin子系统中的src\main\resources\application-dev.yml与src\main\resources\application-prod.yml中更换mysql与redis的地址

需要在服务器安装好java环境（JDK8）

需要先通过maven把boying整个项目install，然后把boying\boying-user\target\boying-user.jar与boying\boying-user\target\boying-admin.jar上传到服务器上
```

**后端用户模块**

```
netstat -tunlp |grep 8000

kill -s 9 30973(根据上一步查询出来的进程id)

nohup java -jar boying-user.jar 

随后可以在http://自己的IP地址:8000/swagger-ui.html 访问用户模块swagger接口
```

**后端管理员模块**

```
netstat -tunlp |grep 7000

kill -s 9 30973(根据上一步查询出来的进程id)

nohup java -jar boying-admin.jar 

随后可以在http://自己的IP地址:7000/swagger-ui.html 访问管理员模块swagger接口
```

# 5.系统架构和组件设计

## 5.1 系统架构概览

### 5.1.1 简述

boying项目为前后端分离项目，前端采用**Vue**开发，后端基于**SpringBoot**实现，前后端通过JSON进行交互，数据库采用了关系型数据库Mysql与内存数据库Redis

前端主要包括了boying-web（用户模块）、boying-admin-web（管理员模块）

后端主要包括了boying-common（通用代码模块）、boying-mbg（mybatis generator模块）、boying-security（安全认证模块）、boying-user（用户模块）、boying-admin（管理员模块）



![博影架构图](https://tongji4m3.oss-cn-beijing.aliyuncs.com/博影架构图.png)

### 5.1.2 三层架构

![图示  描述已自动生成](https://tongji4m3.oss-cn-beijing.aliyuncs.com/clip_image002.png)







## 5.2 前端（代做）

技术栈（Vue，ElementUI这些），怎么实现

可以放个tree图，说明文件夹作用

## 5.3 后端

### 5.3.1 项目结构

```
boying
    ├── boying-admin 后台管理及权限管理模块
    ├── boying-common 封装项目通用代码模块
    ├── boying-mbg MyBatisGenerator自动生成数据库操作代码
    ├── boying-security SpringSecurity认证与权限通用代码模块
    ├── boying-user 前台演出门票购买模块
```

### 5.3.2 技术选型

| 技术             | 版本    | 说明                |
| ---------------- | ------- | ------------------- |
| JDK              | 1.8     | Java开发工具包JDK   |
| Spring Boot      | 2.3.0   | 容器+MVC框架        |
| Spring Security  | 5.1.4   | 认证和授权框架      |
| MyBatis          | 3.4.6   | ORM框架             |
| MyBatisGenerator | 1.3.3   | 数据层代码生成      |
| PageHelper       | 5.1.8   | MyBatis物理分页插件 |
| Swagger-UI       | 2.9.2   | 文档生产工具        |
| Redis            | 5.0     | 分布式缓存          |
| Docker           | 18.09.0 | 应用容器引擎        |
| Druid            | 1.1.10  | 数据库连接池        |
| JWT              | 0.9.0   | JWT登录支持         |
| Lombok           | 1.18.6  | 简化对象封装工具    |
| MySQL            | 5.7.30  | 关系型数据库        |

### 5.3.3 三层架构

后端基于三层架构的思想进行开发，即数据访问层、业务逻辑层、表示层。

#### 5.3.3.1 数据访问层

主要负责数据库的访问（增删改查）。我们使用了Mybatis，并且将数据访问层都封装在了boying-mbg子模块中，便于数据访问层代码的统一管理。

![8958854ef9dcd599e09ae8c853f2ee3](https://tongji4m3.oss-cn-beijing.aliyuncs.com/8958854ef9dcd599e09ae8c853f2ee3.png)

#### 5.3.3.2 业务逻辑层

主要负责业务处理和数据传递，将数据访问层传来的数据加工处理，并将数据传给表示层。我们使用了service接口和service实现分开的方式，这样业务逻辑将会更便于扩展。

![ad5d68b828643ef7498e9937bd0f0b6](https://tongji4m3.oss-cn-beijing.aliyuncs.com/ad5d68b828643ef7498e9937bd0f0b6.png)

#### 5.3.3.3 表示层

主要负责将业务逻辑层处理好的数据展示给用户。并且我们使用Swagger方便后端调试和前端使用。

**用户模块API接口**

![image-20210105171606440](https://tongji4m3.oss-cn-beijing.aliyuncs.com/image-20210105171606440.png)

**管理员模块API接口**

![image-20210105171933006](https://tongji4m3.oss-cn-beijing.aliyuncs.com/image-20210105171933006.png)



# 6.数据库

## 6.1 实体及其属性的介绍

<entity>用户：用来记录用户的账号以及个人信息，用户在注册账号时生成一个实例属性包括：用户ID、用户名、密码、账号状态、头像、真实姓名、身份证号、性别、生日、邮箱、手机号。主码为用户ID。

 

<entity>管理员：管理员与用户类似，其拥有用户拥有的所有属性与权限，但又独立于用户。管理员拥有整个系统的最高权限，以达到对系统进行管理的目的，包括用户管理，订单管理，演出管理，场次管理等。属性包括：管理员ID、用户名、密码、账号状态（0->禁用；1->启用）、头像、邮箱、手机号、创建时间、登录时间。主码为：管理员ID。



 <entity>目录：用来记录演出的分类信息，管理员可以动态的增加目录，管理目录，而且可以实现多级目录对演出进行细致划分。属性包括：目录ID、父级目录ID、目录名称、目录优先级、目录图标、目录描述。主码为：目录ID。



<entity>演出：用来记录所有的演出信息。只能由管理员进行发布与管理，普通用户只有对演出的查看功能。属性包括：演出ID、所属的目录ID、演出名称、演出海报、演出详细描述、演出最低价、该演唱会的最高价、该演出展示的优先级（0为不展示）、具体演出地址、演出开始日期、演出结束日期。主码为：演出ID。

 

<entity>演出场次：用来记录所有演出的演出场次，每一个演出可能会有多个场次，他们可以在不同时间，但是演出的内容是一致的。属性包括：演出场次ID、所属演唱会Id、开始时间、结束时间、优先级（包含上映后,已下架等,以及显示的优先级）。主码为：演出场次ID。

 

<entity>演出座次等级：用来记录所有演出场次的演出座次等级，每一个场次都会有几个座次，例如A，B，C三等座。不同座次属于同一个场次，但是他们的容量与价格都是不一样的。属性包括：座次等级ID、所属场次Id、所属级别（所属哪个级别,例如"外场票", "内场票"等）、演出场次容量、该级别座位的定价、该级别座位的库存。主码为：演出座次等级ID。



<entity>订单：订单是在用户对某个演出的某个场次下单所产生的，一个用户可以有很多个订单，但是每个订单只能对应于某个演出的某个具体场次。其中每个订单可以包含很多张票信息，即包含不同的座次。属性包括：订单ID、所属用户Id、所属演出Id、所属场次Id、订单状态（待观看，已完成,已退订单）、订单时间、订单支付方式、该订单对用户是否可见（即用户是否删除了该订单）、订单总金额、订单所包含票的总数。主码为：订单ID。



<entity>票：票是对于某个演出座次的信息，一个订单可能包含多张票，但是一张票只能对应于某个订单。属性包括：票ID、所属订单Id、所属座次Id、二维码图片（供观影人验证入场） 主码为：票ID



## 6.2 表结构

**user**

| PK/FK | Field           | Type                  | Comment                        |
| ----- | --------------- | --------------------- | ------------------------------ |
| PK    | user_id         | int(11) NOT NULL      |                                |
|       | username        | varchar(255) NOT NULL | 用户名                         |
|       | phone           | varchar(255) NOT NULL | 联系电话                       |
|       | password        | varchar(255) NOT NULL | 密码                           |
|       | real_name       | varchar(255) NULL     | 用户真实姓名                   |
|       | identity_number | varchar(255) NULL     | 用户身份证号                   |
|       | email           | varchar(255) NULL     | 邮箱                           |
|       | age             | int(11) NULL          | 年龄                           |
|       | gender          | tinyint(1) NULL       | 用户性别 1->男,0->女           |
|       | status          | tinyint(1) NULL       | 帐号启用状态：0->禁用；1->启用 |
|       | icon            | varchar(255) NULL     | 个人头像                       |
|       | create_time     | datetime NOT NULL     | 创建时间                       |



**admin**

| PK/FK | Field       | Type                  | Comment                        |
| ----- | ----------- | --------------------- | ------------------------------ |
| PK    | admin_id    | int(11) NOT NULL      |                                |
|       | username    | varchar(255) NOT NULL |                                |
|       | password    | varchar(255) NOT NULL |                                |
|       | icon        | varchar(255) NOT NULL | 头像                           |
|       | email       | varchar(255) NOT NULL |                                |
|       | create_time | datetime NOT NULL     | 创建时间                       |
|       | login_time  | datetime NULL         | 最后登录时间                   |
|       | status      | tinyint(1) NOT NULL   | 帐号启用状态：0->禁用；1->启用 |



**category**

| PK/FK | Field       | Type                 | Comment                       |
| ----- | ----------- | -------------------- | ----------------------------- |
| PK    | category_id | int(11) NOT NULL     |                               |
|       | parent_id   | int(11) NOT NULL     | 上级分类的编号：0表示一级分类 |
|       | name        | varchar(64) NOT NULL | 目录名称                      |
|       | weight      | int(11) NOT NULL     | 用于排序,0则不显示            |
|       | icon        | varchar(64) NULL     | 该目录的图标                  |
|       | description | varchar(255) NULL    | 目录描述                      |



**boying_show**

| PK/FK | Field       | Type                  | Comment                        |
| ----- | ----------- | --------------------- | ------------------------------ |
| PK    | show_id     | int(11) NOT NULL      |                                |
|       | name        | varchar(255) NOT NULL |                                |
| FK    | category_id | int(11) NOT NULL      | 所属的目录                     |
|       | poster      | varchar(255) NOT NULL | 该演唱会的海报图文信息(url)    |
|       | details     | text NULL             | 存储该演唱会等的图文信息       |
|       | min_price   | decimal(10,2) NULL    | 该演唱会的最低价               |
|       | max_price   | decimal(10,2) NULL    | 该演唱会的最高价               |
|       | weight      | int(11) NULL          | 该演出展示的优先基本,0为不展示 |
|       | city        | varchar(255) NOT NULL |                                |
|       | address     | varchar(255) NULL     | 具体演出地址                   |
|       | day_start   | date NULL             | 演出开始日期                   |
|       | day_end     | date NULL             | 演出结束日期                   |



**show_session**

| PK/FK | Field           | Type              | Comment                          |
| ----- | --------------- | ----------------- | -------------------------------- |
| PK    | show_session_id | int(11) NOT NULL  |                                  |
| FK    | show_id         | int(11) NOT NULL  | 所属演唱会Id                     |
|       | start_time      | datetime NOT NULL | 演出场次开始时间                 |
|       | end_time        | datetime NULL     | 演出场次结束时间                 |
|       | weight          | int(11) NOT NULL  | 上映后,已下架等,以及显示的优先级 |





**show_class**

| PK/FK | Field           | Type                  | Comment                               |
| ----- | --------------- | --------------------- | ------------------------------------- |
| PK    | show_class_id   | int(11) NOT NULL      |                                       |
| FK    | show_session_id | int(11) NOT NULL      | 所属场次Id                            |
|       | name            | varchar(11) NOT NULL  | 所属哪个级别,例如"外场票", "内场票"等 |
|       | capacity        | int(11) NOT NULL      | 该级别座位的容量                      |
|       | price           | double(10,2) NOT NULL | 该级别座位的定价                      |
|       | stock           | int(11) NULL          | 该级别座位的库存                      |



**user_order**

| PK/FK | Field           | Type                                | Comment                                     |
| ----- | --------------- | ----------------------------------- | ------------------------------------------- |
| PK    | order_id        | int(11) NOT NULL                    |                                             |
| FK    | user_id         | int(11) NOT NULL                    | 所属用户Id                                  |
| FK    | show_id         | int(11) NULL                        | 所属演出Id                                  |
| FK    | show_session_id | int(11) NOT NULL                    | 所属场次Id                                  |
|       | status          | int(11) NOT NULL                    | 待观看，已完成,已退订单(1,2,3)              |
|       | time            | datetime NOT NULL                   | 订单提交时间                                |
|       | payment         | varchar(255) NULL                   | 订单支付方式                                |
|       | user_delete     | tinyint(1) NOT NULL                 | 该订单对用户是否可见,即用户是否删除了该订单 |
|       | money           | double(10,2) unsigned zerofill NULL | 订单总金额                                  |
|       | ticket_count    | int(11) NULL                        | 票的总数                                    |





**ticket**

| PK/FK | Field         | Type              | Comment                     |
| ----- | ------------- | ----------------- | --------------------------- |
| PK    | ticket_id     | int(11) NOT NULL  |                             |
| FK    | order_id      | int(11) NOT NULL  | 所属订单Id                  |
| FK    | show_class_id | int(11) NOT NULL  | 所属座次Id                  |
|       | qr_code_url   | varchar(255) NULL | 二维码图片,供观影人验证入场 |



## 6.3 数据库关系图



![boying](https://tongji4m3.oss-cn-beijing.aliyuncs.com/boying.jpg)

# 7.团队协作（代做）

介绍团队成员之间协作的机制、方法和技能；

参考他们的，还有软工的，想办法扯扯(敏捷模型什么的)

分工我到时候划一下

### 项目组Github开发规范

1. 统一在**develop**分支下进行提交
2. 每次提交前(最好在写代码前),先`pull`最新的版本,避免代码冲突
3. 每次提交说明修改了哪些地方
4. 遵循统一的代码风格（阿里编码规约）

# 8.其他技术细节

## 8.1 开发工具

| 工具          | 说明                   | 官网                                |
| ------------- | ---------------------- | ----------------------------------- |
| IntelliJ IDEA | java开发工具           | https://www.jetbrains.com/idea/     |
| Navicat       | 数据库设计工具         | http://www.formysql.com/xiazai.html |
| Typora        | Markdown编辑器         | https://typora.io/                  |
| ProcessOn     | 流程图绘制工具         | https://www.processon.com/          |
| XFTP 6        | 上传文件至阿里云服务器 | https://www.netsarang.com/en/xftp/  |

## 8.2 实现流程

+ 小组讨论，确定选题、实现功能点、表设计、业务逻辑等信息
+ 使用Navicat 15 for MySQL  设计表结构
+ 搭建SpringBoot+Mybatis环境初始项目环境
+ 项目集成Swagger、Redis等开发工具
+ 在云服务器上安装docker，并下载redis,mysql镜像，启动容器
+ Idea连接远程阿里云服务器中docker的redis、mysql容器
+ 分模块构建springboot项目，并且构建boying-common、boying-mbg、boying-security模块
+ 实现boying-user、boying-admin相关业务逻辑
+ 前端通过Vue进行项目开发，并且通过后端Swagger接口查看API并用Axios与后端交互
+ 项目完成并调试通过后，全部统一部署于阿里云上

## 8.3 遇到的问题与解决方案

### 8.3.1 数据库方面

+ class不能命名为class，可以修改为show_class，避开Java关键字
+ 订单不能命名为order，可以修改为user_order，避开sql关键字（order by）
+ 排序规则设置为`utf-bin`才能在查询中区分大小写
+ 数据库中密码等字段要`varchar(255)`,否则密码加密后超出大小限制

### 8.3.2 前后端方面

+ 使用Swagger进行登录一定要先配置` Bearer token值 `
+ 阿里云OSS跨域问题,需要在阿里云控制台中进行跨域相关配置
+ 需要给服务器配置端口，否则访问不到

### 8.3.3 缓存方面

如果直接修改数据库，则Redis缓存中的数据可能仍然存在,所以修改了数据库数据后需要手动清空缓存

解决方案：

```sh
# 连接云服务器命令行
docker exec -it redis redis-cli -a "redis"
flushall
```






